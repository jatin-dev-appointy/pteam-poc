version: "3.7"
services:
    hydra:
        image: oryd/hydra:v2.2.0
        ports:
            - "4444:4444" # Public port
            - "4445:4445" # Admin port
            - "5555:5555" # Port for hydra token user
        volumes:
            - type: bind
              source: ./config
              target: /etc/config/hydra
        environment:
            - DSN=postgres://pteam:appointyadmin@34.134.190.227:5432/pteam_hydra
        command: serve -c /etc/config/hydra/hydra.yml all --dev
        restart: unless-stopped
        depends_on:
            - hydra-migrate
        networks:
            - intranet
    hydra-migrate:
        image: oryd/hydra:v2.2.0
        environment:
            - DSN=postgres://pteam:appointyadmin@34.134.190.227:5432/pteam_hydra
        command: migrate -c /etc/config/hydra/hydra.yml sql -e --yes
        volumes:
            - type: bind
              source: ./config
              target: /etc/config/hydra
        restart: on-failure
        networks:
            - intranet

networks:
    intranet:
volumes:
    hydra-sqlite:
    kratos-sqlite:
